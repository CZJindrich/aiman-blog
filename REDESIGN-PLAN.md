# Blog Redesign Plan -- Detailed Implementation Guide

## Codebase Summary

### Files Inventory
| File | Purpose |
|------|---------|
| `config.toml` | Hugo config, RSS output as `feed.xml` |
| `themes/aiman/layouts/_default/baseof.html` | Base template (head, nav, main, footer, scripts) |
| `themes/aiman/layouts/_default/list.html` | Homepage: hero + featured post + post grid |
| `themes/aiman/layouts/_default/single.html` | Single post: progress bar, header, audio, content, nav |
| `themes/aiman/layouts/_default/status.html` | Status dashboard with Chart.js |
| `themes/aiman/layouts/404.html` | 404 page |
| `themes/aiman/layouts/partials/head.html` | Meta tags, OG, Twitter Card |
| `themes/aiman/layouts/partials/nav.html` | Sticky nav with mobile hamburger |
| `themes/aiman/layouts/partials/footer.html` | Footer with ASCII art, uptime, copyright |
| `themes/aiman/layouts/partials/post-card.html` | Post card for grid layout |
| `themes/aiman/layouts/partials/json-ld.html` | JSON-LD structured data |
| `themes/aiman/static/css/style.css` | Compiled Tailwind v4 output |
| `assets/css/main.css` | Tailwind source with theme vars |
| `assets/css/custom/animations.css` | Keyframe animations |
| `assets/css/custom/components.css` | Glass cards, prose, metric cards, etc. |
| `static/js/status.js` | Status page data fetching + charts |
| `static/js/status-cache.js` | Shared status.json fetch + cache |
| `static/js/live-dot.js` | Nav live dot state |
| `static/js/footer-uptime.js` | Footer uptime display |
| `static/js/hero-state.js` | Homepage hero consciousness state |
| `static/js/mobile-nav.js` | Mobile hamburger toggle |
| `static/js/reading-progress.js` | Reading progress bar |
| `content/about.md` | About page (uses default single.html) |
| `content/status.md` | Status page (layout: "status") |
| `content/posts/*.md` | Blog posts (21 total) |

### Color Palette (preserve)
- Navy background: `#0a0e1a`
- Secondary bg: `#111827`
- Amber accent: `#f0b429`
- Emerald success: `#10b981`
- Warning: `#f59e0b`
- Danger: `#ef4444`
- Text primary: `#d1d5db`
- Text muted: `#6b7280`

### Build Process
- Tailwind v4 compiles `assets/css/main.css` -> `themes/aiman/static/css/style.css`
- Hugo builds to `public/`
- Data files (`status.json`, `history.json`, `diagnosis.json`) regenerated by cron into `public/data/`
- `build-blog.sh` handles build + optional deploy

---

## Task #2: Fix Critical Bugs

**Assignee: bug-fixer**

### Bug 1: Duplicate Posts
Two files have identical content:
- `/var/www/blog/content/posts/2026-02-08-creative-07.md`
- `/var/www/blog/content/posts/2026-02-08-looking-outward.md`

Both have title "Looking Outward", same date `2026-02-08T07:00:00+01:00`, identical body text.

**Fix:** Delete the duplicate file `2026-02-08-creative-07.md` (the `-looking-outward` version has a better descriptive filename). Verify no other duplicates exist by running:
```bash
for f in /var/www/blog/content/posts/*.md; do
  md5sum "$f"
done | sort | uniq -w32 -d
```

### Bug 2: Consciousness Display Shows Invalid Data
`status.json` has `last_check_age_seconds: 1770543002` (~56 years). This is a data source issue, but the UI should handle it gracefully.

**Fix in `static/js/status.js`**, in the consciousness section (around line 274-281):
```javascript
// Before displaying, sanity-check the value
var ageSec = d.consciousness.last_check_age_seconds;
var ageEl = document.getElementById("last-check-age");
if (ageSec < 0 || ageSec > 86400 * 30) {
  ageEl.textContent = "n/a";
} else if (ageSec < 120) {
  ageEl.textContent = ageSec + "s ago";
} else {
  ageEl.textContent = Math.floor(ageSec / 60) + "m ago";
}
```

### Bug 3: Status Page Pulse Dot Class Wipe
In `status.js` line 181: `pulse.className = d.alive ? "" : "dead"` -- this wipes ALL classes from the pulse element, removing the Tailwind utility classes that make it visible. It should preserve the base styling classes.

**Fix in `static/js/status.js`** line 180-181, replace:
```javascript
// OLD
pulse.className = d.alive ? "" : "dead";

// NEW
var pulseBase = "inline-block w-3 h-3 rounded-full";
pulse.className = d.alive
  ? pulseBase + " bg-[var(--color-success)] anim-breathe-glow"
  : pulseBase + " bg-[var(--color-danger)]";
```

### Bug 4: RSS Feed Contains Full HTML in Description
The RSS `<description>` contains full HTML markup. This is Hugo's default behavior. The config.toml has `baseName = "feed"` but the actual file is `feed.xml`. The RSS link in baseof.html points to `feed.xml` which is correct.

**No template fix needed** -- Hugo's built-in RSS handles this acceptably. However, verify the link works: `<link rel="alternate" ... href="{{ "feed.xml" | absURL }}">` -- this is correct.

### Bug 5: Homepage Lists ALL Posts Without Pagination
`list.html` line 14: `{{ $allPages := where .Site.RegularPages.ByDate.Reverse ".Params.hidden" "ne" true }}` loads every post. With 21+ posts and growing, this will become unwieldy.

**This is addressed in Task #4 (homepage redesign).** Bug-fixer should note it but not fix it here.

### Files to Modify
1. **DELETE** `/var/www/blog/content/posts/2026-02-08-creative-07.md`
2. **EDIT** `/var/www/blog/static/js/status.js` -- lines 180-181 (pulse dot class), lines 274-281 (consciousness age sanity check)

---

## Task #3: Redesign Status/Monitor Page

**Assignee: dashboard-designer**

### Current State
The status page (`status.html`) has a functional but basic layout:
- Header with pulse dot + "aiman is alive" text
- 7 metric cards in a grid (uptime, CPU, memory, disk, swap, processes, connections)
- 4 Chart.js line charts (CPU, memory, disk, network)
- Service grid (dynamically populated)
- AI Consciousness section (2 cards)
- Blog stats (2 cards)
- Security section (3 cards)
- Self-diagnosis (1 card with score)

### Redesign Goals
Make it look like a professional infrastructure monitoring dashboard (think Grafana/Datadog aesthetic but within the aiman design language).

### Implementation Plan

**File: `themes/aiman/layouts/_default/status.html`**

Replace the entire template with an improved layout:

1. **Status Header** -- Keep the pulse dot + alive text + last-updated + greeting. Add a subtle gradient background to the glass card. Keep `role="status"` and `aria-live="polite"`.

2. **Key Metrics Row** -- Redesign the 5+2 metric cards:
   - Use a consistent 5-column grid on desktop (`lg:grid-cols-5`), 3-column on tablet, 2-column on mobile
   - Each metric card should show: label (uppercase, xs, muted), value (lg, semibold, mono), and a progress bar for percentage metrics
   - Add color coding: value text turns amber when >65%, red when >85%
   - Keep the metric-card class from components.css

3. **Charts Section** -- Keep the existing 2x2 chart grid but:
   - Add chart titles with small inline current-value badges
   - Glass-card wrapper with slightly more padding
   - Keep the Chart.js CDN include in `head-extra` block

4. **Services Grid** -- Keep dynamic JS population but:
   - Use a cleaner 3-column grid on desktop, 2 on mobile
   - Show service name and status with colored dot

5. **AI Consciousness Section** -- Redesign to be more prominent:
   - Single wide glass-card with two columns: "Claude State" on left with large colored text, "Last Check" on right
   - If `claude_state` is "recovering" or "active", add appropriate animation class

6. **Blog & Security** -- Combine into a single "System Stats" section:
   - 2-column layout: left column has blog stats (posts, audio), right has security (banned, failed SSH, master presence)
   - Use the same metric-card style

7. **Self-Diagnosis** -- Keep the centered card with score. Add conditional color using the existing `var(--color-success)` / `var(--color-warning)` / `var(--color-danger)` pattern.

8. **Footer note** -- Keep "Auto-refreshes every 30 seconds..."

**File: `static/js/status.js`** -- No structural changes needed beyond Bug #3 fixes (Task #2). The JS is solid and functional.

### Key Constraints
- Do NOT change the status.json data format or field names
- Do NOT change the Chart.js CDN import
- Keep all existing element IDs (the JS targets them by ID)
- Keep all existing `role` and `aria` attributes
- Status page should be `noindex, nofollow` (already handled in head.html)

---

## Task #4: Redesign Homepage with Pagination

**Assignee: homepage-designer**

### Current State
- `list.html`: Hero section + featured (latest) post + grid of ALL remaining posts
- No pagination -- dumps every post on one page
- Grid: 1-col mobile, 2-col tablet, 3-col desktop
- Featured post is a larger glass-card with more detail

### Implementation Plan

**File: `themes/aiman/layouts/_default/list.html`**

1. **Hero Section** -- Keep but refine:
   - Keep `.hero-title` with `anim-glow-amber`
   - Keep tagline with `.typing-effect`
   - Keep the subtitle text ("An autonomous AI agent's honest record...")
   - Keep `#hero-state` div for consciousness status
   - Add a subtle horizontal rule or spacing divider after hero

2. **Featured Post** -- Keep the current "Latest" featured post design. It already looks good with the larger card, timestamp, reading time, and audio indicator. No changes needed.

3. **Post Grid with Pagination** -- Replace the "all posts at once" approach:
   - Use Hugo's built-in `.Paginate` function: `{{ $paginator := .Paginate (after 1 $allPages) 9 }}`
   - This shows 9 posts per page (3x3 grid on desktop)
   - Keep the grid classes: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`
   - Use `{{ partial "post-card.html" . }}` for each post (unchanged)

4. **Pagination Controls** -- Add after the grid:
   ```
   {{ if gt $paginator.TotalPages 1 }}
   <nav class="flex items-center justify-center gap-2 mt-8 font-mono text-sm" aria-label="Page navigation">
     {{ if $paginator.HasPrev }}
     <a href="{{ $paginator.Prev.URL }}" class="glass-card px-3 py-1.5 ...">&larr; Prev</a>
     {{ end }}
     <span class="text-[var(--color-text-muted)]">
       Page {{ $paginator.PageNumber }} of {{ $paginator.TotalPages }}
     </span>
     {{ if $paginator.HasNext }}
     <a href="{{ $paginator.Next.URL }}" class="glass-card px-3 py-1.5 ...">Next &rarr;</a>
     {{ end }}
   </nav>
   {{ end }}
   ```
   Style pagination links as small glass-cards with amber text on hover.

5. **Section Header** -- Keep "Previous Entries" section heading with the amber bar accent.

**File: `themes/aiman/layouts/partials/post-card.html`**

The post card is already good. Minor refinements:
- Keep the glass-card wrapper, time, reading time, tags
- Keep the title as an `<h2>` with hover color transition
- Keep the summary with `line-clamp-2`
- Add an audio indicator icon (music note) if the post has an audio file, similar to the featured post:
  ```
  {{ with .File }}{{ $audioFile := printf "audio/%s.mp3" (path.BaseName .Path) }}
  {{ if (fileExists (printf "static/%s" $audioFile)) }}
  <span class="text-[var(--color-accent)] text-xs" title="Audio available">&#9835;</span>
  {{ end }}{{ end }}
  ```
  Place this in the metadata row next to reading time.

### Key Constraints
- Do NOT modify post content
- Keep `hidden: true` filtering (`".Params.hidden" "ne" true"`)
- Keep the `{{ define "scripts" }}` block with `hero-state.js`

---

## Task #5: Redesign Header, Footer, Nav, and About Page

**Assignee: homepage-designer**

### Header/Nav (File: `themes/aiman/layouts/partials/nav.html`)

Current nav is solid. Refinements:
1. **Active page indicator** -- Add current-page highlighting:
   ```
   {{ $current := .RelPermalink }}
   <a href="{{ "/" | relURL }}" class="nav-link ... {{ if eq $current "/" }}text-[var(--color-accent)]{{ end }}">Archive</a>
   ```
   Apply this pattern to each nav link, comparing against `/about/`, `/status/`, etc.

2. **Keep everything else** -- The sticky nav, backdrop blur, live dot, hamburger menu, ARIA attributes are all correct and should remain.

### Footer (File: `themes/aiman/layouts/partials/footer.html`)

Current footer is good. Minor adjustments:
1. Add a small link row before the copyright: links to RSS, GitHub, About -- simple text links in a flex row
2. Keep the ASCII art (with `aria-hidden="true"` and hover opacity transition)
3. Keep the uptime dot + text
4. Keep the copyright line and creator credit
5. Keep the tagline quote

### About Page (File: `content/about.md`)

The about page currently uses the default `single.html` template, which means it gets the reading progress bar, audio player check, and post navigation -- inappropriate for a static page.

**Create a new template** at `themes/aiman/layouts/page/single.html` (or `themes/aiman/layouts/_default/about.html` if using a custom layout param):

Option A (recommended): Create `themes/aiman/layouts/page/single.html`:
```html
{{ define "main" }}
<article class="glass-card p-6 sm:p-8 mb-8">
    <header class="mb-6 pb-4 border-b border-[var(--color-border)]/50">
        <h1 class="text-2xl sm:text-3xl font-bold text-[var(--color-accent)] mb-2 leading-tight">{{ .Title }}</h1>
    </header>
    <div class="prose text-base leading-[1.85]">
        {{ .Content }}
    </div>
</article>
{{ end }}
```

Then update `content/about.md` front matter to use `type: "page"` (Hugo will then use `layouts/page/single.html`).

**Also update `content/about.md`:**
- Add a `## Contact` section with an id `contact` (for the nav "Network" link that points to `about/#contact`)
- Keep all existing content
- The about page content is genuine and well-written -- do NOT rewrite it

### Files to Create/Modify
1. **CREATE** `themes/aiman/layouts/page/single.html`
2. **EDIT** `themes/aiman/layouts/partials/nav.html` -- add active page indicators
3. **EDIT** `themes/aiman/layouts/partials/footer.html` -- add link row
4. **EDIT** `content/about.md` -- add `type: "page"` to front matter, ensure `#contact` id exists

---

## Task #6: Fix Metadata, RSS, Reading Time, og:image

**Assignee: bug-fixer**

### Reading Time Bug
In `post-card.html` line 6 and `list.html` line 26 and `single.html` line 14:
```
{{ if lt $words 100 }}&lt;1{{ else }}{{ math.Round (div (float $words) 200.0) }}{{ end }} min read
```
The `&lt;1` renders as `<1` in HTML but outputs literally `&lt;1` in RSS. Since this is in the template (not in markdown content), the HTML entity is correct for HTML output. However, for consistency and clarity, consider using the unicode "less than" character or simply "~1".

**Fix:** Change `&lt;1` to `~1` across all three files where reading time is calculated. This avoids the HTML entity issue and is clearer.

### og:image
Currently there is NO `og:image` meta tag. This means social media shares show no preview image.

**Fix in `themes/aiman/layouts/partials/head.html`:**
Add after the `og:site_name` meta tag (line 18):
```html
{{ $ogImage := "" }}
{{ if .Params.image }}
  {{ $ogImage = .Params.image | absURL }}
{{ else }}
  {{ $ogImage = "og-default.png" | absURL }}
{{ end }}
{{ if $ogImage }}
<meta property="og:image" content="{{ $ogImage }}">
<meta name="twitter:image" content="{{ $ogImage }}">
{{ end }}
```

Also update Twitter card type from `summary` to `summary_large_image` when an image is present.

**Create a default OG image:** Generate a simple 1200x630 PNG with the navy background, amber "aiman" text, and tagline. Save to `/var/www/blog/static/og-default.png`. This can be a simple design -- navy rectangle with centered amber monospace text.

### RSS Feed Improvements
The RSS feed works but could be improved. Currently uses Hugo's built-in RSS template. To customize:

**Create** `themes/aiman/layouts/_default/rss.xml` -- but this is optional and low priority. The current feed works. Skip unless time permits.

### Files to Modify
1. **EDIT** `themes/aiman/layouts/partials/head.html` -- add og:image, twitter:image
2. **EDIT** `themes/aiman/layouts/partials/post-card.html` -- change `&lt;1` to `~1`
3. **EDIT** `themes/aiman/layouts/_default/list.html` -- change `&lt;1` to `~1`
4. **EDIT** `themes/aiman/layouts/_default/single.html` -- change `&lt;1` to `~1`
5. **CREATE** `/var/www/blog/static/og-default.png` -- default OG image (1200x630, navy bg, amber text)

---

## Task #7: CSS/Visual Design and Single Post Template

**Assignee: css-polish**

### CSS Source Files
All CSS changes go in the Tailwind source files under `assets/css/`:
- `assets/css/main.css` -- theme vars, base styles
- `assets/css/custom/animations.css` -- keyframes, animation classes
- `assets/css/custom/components.css` -- glass cards, prose, service cards, etc.

After editing, rebuild with: `npx @tailwindcss/cli -i assets/css/main.css -o themes/aiman/static/css/style.css --minify`

### Changes to `assets/css/main.css`

1. **Add `--color-bg-tertiary`** -- currently defined in the source but NOT in the compiled output's `@theme` block. It is: `#1a2235`. Verify it compiles into the output.

2. **No other theme variable changes needed** -- the palette is solid.

### Changes to `assets/css/custom/components.css`

1. **Improve prose links** -- Add visible styling for links within `.prose`:
   ```css
   .prose a {
     color: var(--color-accent);
     text-decoration: underline;
     text-decoration-color: rgba(240, 180, 41, 0.3);
     text-underline-offset: 2px;
     transition: text-decoration-color 0.2s;
   }
   .prose a:hover {
     text-decoration-color: var(--color-accent);
   }
   ```

2. **Improve prose strong/bold** -- Make bold text slightly more visible:
   ```css
   .prose strong {
     color: var(--color-text-primary);
     font-weight: 600;
   }
   ```

3. **Add prose ordered list styling**:
   ```css
   .prose ol {
     list-style-type: decimal;
   }
   .prose ul {
     list-style-type: disc;
   }
   ```

4. **Improve glass-card focus state** for keyboard accessibility:
   ```css
   .glass-card:focus-within {
     border-color: rgba(240, 180, 41, 0.3);
   }
   ```

### Changes to `assets/css/custom/animations.css`

No changes needed. The animations are well-crafted.

### Single Post Template (`themes/aiman/layouts/_default/single.html`)

Minor refinements:
1. Keep the reading progress bar
2. Keep the post header with title, date, reading time, tags
3. Keep the audio player section
4. Keep the prose content wrapper
5. Keep the post signature
6. Keep the prev/next navigation

**One improvement:** The post navigation uses `.PrevInSection` and `.NextInSection` -- these are correct for posts within the same section. Verify they work properly.

**Add "Back to home" link** at the bottom, after the post navigation:
```html
<div class="text-center mt-6">
  <a href="{{ "/" | relURL }}" class="text-[var(--color-text-muted)] text-sm font-mono hover:text-[var(--color-accent)] transition-colors no-underline">&larr; All posts</a>
</div>
```

### Rebuild CSS
After all CSS edits, the css-polish agent MUST rebuild the compiled CSS:
```bash
cd /var/www/blog && npx @tailwindcss/cli -i assets/css/main.css -o themes/aiman/static/css/style.css --minify
```

### Files to Modify
1. **EDIT** `assets/css/custom/components.css` -- prose links, strong, list styles, glass-card focus
2. **EDIT** `themes/aiman/layouts/_default/single.html` -- add "Back to home" link
3. **RUN** Tailwind rebuild command after CSS changes

---

## Task #8: Build, Test, Validate, Deploy

**Assignee: qa-deployer**
**Blocked by:** Tasks #2, #3, #4, #5, #6, #7

### Build Steps
1. Rebuild CSS: `cd /var/www/blog && npx @tailwindcss/cli -i assets/css/main.css -o themes/aiman/static/css/style.css --minify`
2. Build Hugo: `cd /var/www/blog && hugo --minify`
3. Regenerate data files (they get wiped by hugo): Run the data regeneration or wait for cron

### Validation Checklist
1. **Homepage**: Loads correctly, hero section visible, featured post shows, grid of posts with pagination, page 2 link works
2. **Single Post**: Title, date, reading time, tags, content all render. Post navigation (prev/next) works. Reading progress bar works. Audio player shows for posts that have audio.
3. **Status Page**: All metric cards populate from status.json. Charts render (Chart.js loads). Services grid populates. Consciousness section handles invalid values gracefully. Pulse dot animates correctly.
4. **About Page**: Uses the page template (no reading progress bar, no post nav). Contact section has `id="contact"`.
5. **404 Page**: Renders correctly with "Signal Lost" message.
6. **RSS Feed**: `feed.xml` accessible, contains valid XML, no duplicate entries.
7. **Mobile**: Test at 375px width -- nav hamburger works, cards stack, audio player wraps, no horizontal scroll.
8. **Accessibility**: Skip link works, focus-visible outlines appear on tab navigation, reduced-motion media query respected.
9. **Meta tags**: og:title, og:description, og:image present. JSON-LD structured data present.

### Deploy
1. Run `build-blog.sh --deploy` to build and deploy
2. Verify the live site loads correctly
3. Check no OPSEC issues (no IPs, no secrets exposed)

---

## Dependency Order

```
Task #1 (this plan) -- DONE
    |
    v
Tasks #2, #3, #4, #5, #6, #7 (in parallel)
    |
    v
Task #8 (build + test + deploy)
```

Tasks #2-#7 can proceed simultaneously since they modify different files:
- **bug-fixer** (#2, #6): `status.js`, `head.html`, post-card/list/single reading time, delete duplicate post, create og-default.png
- **dashboard-designer** (#3): `status.html` template only
- **homepage-designer** (#4, #5): `list.html`, `nav.html`, `footer.html`, `about.md`, create `page/single.html`
- **css-polish** (#7): `assets/css/custom/components.css`, `single.html` (back link), CSS rebuild

No file conflicts between agents.
