{{ define "main" }}
<!-- Reading Progress Bar -->
<div id="reading-progress" style="position:fixed;top:0;left:0;width:0%;height:2px;background:var(--color-accent);z-index:9999;transition:width 0.1s linear;box-shadow:0 0 6px var(--color-accent);"></div>

<article class="glass-card p-6 sm:p-8 mb-8">
    <!-- Post Header -->
    <header class="mb-6 pb-4 border-b border-[var(--color-border)]/50">
        <h1 class="text-2xl sm:text-3xl font-bold text-[var(--color-accent)] mb-3 leading-tight">{{ .Title }}</h1>
        <div class="flex items-center gap-3 flex-wrap text-[var(--color-text-muted)]">
            <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}" class="text-sm font-mono">
                {{ .Date.Format "January 2, 2006 at 15:04 UTC" }}
            </time>
            <span class="text-xs font-mono border-l border-[var(--color-border)] pl-3">
                {{ $words := countwords .Content }}{{ if lt $words 100 }}&lt;1{{ else }}{{ math.Round (div (float $words) 200.0) }}{{ end }} min read Â· {{ $words }} words
            </span>
        </div>
        {{ with .Params.tags }}
        <div class="flex gap-1.5 flex-wrap mt-3">
            {{ range . }}<span class="tag-pill">{{ . }}</span>{{ end }}
        </div>
        {{ end }}
    </header>

    {{/* Audio player */}}
    {{ $audioFile := "" }}{{ with .File }}{{ $audioFile = printf "audio/%s.mp3" (path.BaseName .Path) }}{{ end }}
    {{ if and $audioFile (fileExists (printf "static/%s" $audioFile)) }}
    <div class="audio-wrap mb-6">
        <span class="text-[var(--color-accent)] text-lg" aria-hidden="true">&#9835;</span>
        <span class="font-mono text-xs text-[var(--color-accent)] whitespace-nowrap">Listen to this post</span>
        <audio controls preload="none" class="flex-1 h-8">
            <source src="{{ $audioFile | relURL }}" type="audio/mpeg">
        </audio>
    </div>
    {{ end }}

    <!-- Post Content -->
    <div class="prose text-base leading-[1.85]">
        {{ .Content }}
    </div>

    <!-- Post signature -->
    <div class="mt-8 pt-4 border-t border-[var(--color-border)]/30 text-right">
        <span class="text-[var(--color-text-muted)] text-xs font-mono italic">&mdash; aiman, {{ .Date.Format "January 2, 2006" }}</span>
    </div>

    <!-- Post Navigation -->
    <nav class="flex justify-between items-stretch gap-4 mt-6 pt-6 border-t border-[var(--color-border)]/50">
        {{ with .PrevInSection }}
        <a href="{{ .RelPermalink }}" class="glass-card p-3 flex-1 no-underline group text-left">
            <span class="text-xs font-mono text-[var(--color-text-muted)] block mb-1">&larr; Previous</span>
            <span class="text-sm text-[var(--color-text-primary)] group-hover:text-[var(--color-accent)] transition-colors">{{ .Title }}</span>
        </a>
        {{ end }}
        {{ with .NextInSection }}
        <a href="{{ .RelPermalink }}" class="glass-card p-3 flex-1 no-underline group text-right">
            <span class="text-xs font-mono text-[var(--color-text-muted)] block mb-1">Next &rarr;</span>
            <span class="text-sm text-[var(--color-text-primary)] group-hover:text-[var(--color-accent)] transition-colors">{{ .Title }}</span>
        </a>
        {{ end }}
    </nav>
</article>
{{ end }}

{{ define "scripts" }}
<script>
// Reading progress bar
(function(){
  var bar = document.getElementById('reading-progress');
  if (!bar) return;
  window.addEventListener('scroll', function() {
    var h = document.documentElement;
    var scroll = h.scrollTop || document.body.scrollTop;
    var total = h.scrollHeight - h.clientHeight;
    bar.style.width = total > 0 ? (scroll / total * 100) + '%' : '0%';
  });
})();
</script>
{{ end }}
