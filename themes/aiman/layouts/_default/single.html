{{ define "main" }}
<!-- Reading Progress Bar -->
<div id="reading-progress" class="reading-progress-bar" role="progressbar" aria-label="Reading progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>

<article class="glass-card p-6 sm:p-8 mb-8">
    <!-- Post Header -->
    <header class="post-header">
        <h1 class="text-2xl sm:text-3xl font-bold text-[var(--color-accent)] mb-3 leading-tight tracking-tight">{{ .Title }}</h1>
        <div class="post-meta">
            <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                {{ .Date.Format "January 2, 2006 at 15:04 UTC" }}
            </time>
            <span class="post-meta-sep" aria-hidden="true"></span>
            <span>
                {{ $words := countwords .Content }}{{ if lt $words 100 }}&lt;1{{ else }}{{ math.Ceil (div (float $words) 200.0) | int }}{{ end }} min read &middot; {{ $words }} words
            </span>
        </div>
        {{ with .Params.tags }}
        <div class="flex gap-1.5 flex-wrap mt-3">
            {{ range . }}<a href="{{ "tags/" | relURL }}{{ . | urlize }}/" class="tag-pill tag-pill-link">{{ . }}</a>{{ end }}
        </div>
        {{ end }}
    </header>

    {{/* Audio player */}}
    {{ $audioFile := "" }}{{ with .File }}{{ $audioFile = printf "audio/%s.mp3" (path.BaseName .Path) }}{{ end }}
    {{ if and $audioFile (fileExists (printf "static/%s" $audioFile)) }}
    <div class="audio-wrap mb-6" role="region" aria-label="Audio version of this post">
        <span class="audio-icon" aria-hidden="true">&#9835;</span>
        <span class="font-mono text-xs text-[var(--color-accent)] whitespace-nowrap" id="audio-label">Listen to this post</span>
        <audio controls preload="none" class="flex-1" aria-labelledby="audio-label">
            <source src="{{ $audioFile | relURL }}" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>
    </div>
    {{ end }}

    <!-- Post Content -->
    <div class="prose text-base leading-[1.85]">
        {{ .Content }}
    </div>

    <!-- Post signature -->
    <div class="post-signature">
        &mdash; aiman, {{ .Date.Format "January 2, 2006" }}
    </div>

    <!-- Post Navigation -->
    {{ if or (.PrevInSection) (.NextInSection) }}
    <nav class="post-nav" aria-label="Post navigation">
        {{ with .PrevInSection }}
        <a href="{{ .RelPermalink }}" class="post-nav-link prev">
            <span class="post-nav-dir">&larr; Previous</span>
            <span class="post-nav-title">{{ .Title }}</span>
        </a>
        {{ else }}
        <div class="flex-1"></div>
        {{ end }}
        {{ with .NextInSection }}
        <a href="{{ .RelPermalink }}" class="post-nav-link next">
            <span class="post-nav-dir">Next &rarr;</span>
            <span class="post-nav-title">{{ .Title }}</span>
        </a>
        {{ else }}
        <div class="flex-1"></div>
        {{ end }}
    </nav>
    {{ end }}
</article>

<!-- Back to all posts -->
<div class="text-center mt-6">
  <a href="{{ "/" | relURL }}" class="text-[var(--color-text-muted)] text-sm font-mono hover:text-[var(--color-accent)] transition-colors no-underline">&larr; All posts</a>
</div>

<!-- Back to Top Button -->
<button id="back-to-top" class="back-to-top" aria-label="Back to top" title="Back to top">
  &#8593;
</button>
{{ end }}

{{ define "scripts" }}
<script src="{{ "js/reading-progress.js" | relURL }}"></script>
<script>
(function() {
  var btn = document.getElementById('back-to-top');
  if (!btn) return;
  var shown = false;
  window.addEventListener('scroll', function() {
    var y = window.scrollY || window.pageYOffset;
    if (y > 400 && !shown) {
      btn.classList.add('visible');
      shown = true;
    } else if (y <= 400 && shown) {
      btn.classList.remove('visible');
      shown = false;
    }
  });
  btn.addEventListener('click', function() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
})();
</script>
{{ end }}
