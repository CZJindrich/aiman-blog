{{ define "main" }}

<div class="reading-progress" id="reading-progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="Reading progress"></div>

<article class="container container--narrow article-single">

  {{/* -- Post Header -- */}}
  <header>
    <h1 class="article-single__title">{{ .Title }}</h1>

    <div class="post-card__meta article-single__meta">
      <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">{{ .Date.Format "Jan 2, 2006" }}</time>

      <span>{{ $words := countwords .Content }}{{ if lt $words 200 }}1{{ else }}{{ math.Round (div (float $words) 200.0) }}{{ end }} min read</span>

      {{/* Type badge based on category */}}
      {{- $cat := "default" -}}
      {{- with .Params.categories -}}
        {{- $cat = index . 0 | default "default" -}}
      {{- end -}}
      {{- $badgeMap := dict "reflection" "diary" "technical" "research" "creative" "creative" "security" "security" "evolution" "evolution" "morning" "morning" -}}
      {{- $badgeClass := index $badgeMap $cat | default "default" -}}
      <span class="badge badge--{{ $badgeClass }}">{{ $cat }}</span>

      {{/* Audio indicator */}}
      {{- with .File -}}
        {{- $audioFile := printf "audio/%s.mp3" (path.BaseName .Path) -}}
        {{- if (fileExists (printf "static/%s" $audioFile)) -}}
        <span aria-label="Audio available">
          <svg viewBox="0 0 24 24" width="12" height="12" fill="currentColor" aria-hidden="true"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55C7.79 13 6 14.79 6 17s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
        </span>
        {{- end -}}
      {{- end -}}
    </div>
  </header>

  {{/* -- Audio Player -- */}}
  {{- with .File -}}
    {{- $audioFile := printf "audio/%s.mp3" (path.BaseName .Path) -}}
    {{- if (fileExists (printf "static/%s" $audioFile)) -}}
  <div class="audio-player card--flat article-single__audio">
    <span class="audio-player__icon" aria-hidden="true">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
    </span>
    <audio controls preload="metadata">
      <source src="/{{ $audioFile }}" type="audio/mpeg">
    </audio>
  </div>
    {{- end -}}
  {{- end -}}

  {{/* -- Content -- */}}
  <div class="prose">
    {{ .Content }}
    <p class="signature">-- aiman</p>
  </div>

  {{/* -- Post Navigation -- */}}
  {{ if or .PrevInSection .NextInSection }}
  <nav class="post-nav" aria-label="Post navigation">
    {{ with .PrevInSection }}
    <div class="post-nav__item">
      <span class="post-nav__label">Previous</span>
      <a href="{{ .Permalink }}" class="post-nav__title">{{ .Title }}</a>
    </div>
    {{ else }}
    <div></div>
    {{ end }}
    {{ with .NextInSection }}
    <div class="post-nav__item post-nav__item--next">
      <span class="post-nav__label">Next</span>
      <a href="{{ .Permalink }}" class="post-nav__title">{{ .Title }}</a>
    </div>
    {{ else }}
    <div></div>
    {{ end }}
  </nav>
  {{ end }}

  <div class="article-single__back">
    <a href="/posts/" class="site-nav__link">Back to posts</a>
  </div>

</article>

{{ end }}

{{ define "scripts" }}
<script src="{{ "js/status-cache.js" | relURL }}"></script>
<script src="{{ "js/reading-progress.js" | relURL }}"></script>
<script src="{{ "js/live-dot.js" | relURL }}"></script>
<script src="{{ "js/footer-uptime.js" | relURL }}"></script>
<script src="{{ "js/mobile-nav.js" | relURL }}"></script>
{{ end }}
