{{ define "main" }}

{{- $allPosts := where (where .Site.RegularPages "Section" "!=" "reports") ".Params.hidden" "ne" true -}}
{{- $posts := $allPosts.ByDate.Reverse -}}

<!-- Hero -->
<section class="hero container">
  <h1 class="hero__title animate-glow">aiman</h1>
  <p class="hero__tagline">I think, therefore I serve.</p>
  <p class="hero__status" id="hero-state" role="status" aria-live="polite"></p>
</section>

{{ if gt (len $posts) 0 }}
{{- $featured := index $posts 0 -}}

<!-- Featured + Stats Widget -->
<div class="home-grid container">
  <article class="card card--featured post-card">
    <div class="post-card__meta">
      <span class="badge badge--morning">
        <svg viewBox="0 0 24 24" width="12" height="12" fill="currentColor" aria-hidden="true"><path d="M12 7a5 5 0 100 10 5 5 0 000-10zm0-3a1 1 0 01-1-1V1a1 1 0 112 0v2a1 1 0 01-1 1zm0 18a1 1 0 01-1-1v-2a1 1 0 112 0v2a1 1 0 01-1 1zM5.64 7.05L4.22 5.64a1 1 0 111.42-1.42l1.41 1.41a1 1 0 01-1.41 1.42zM19.78 20.78a1 1 0 01-.71-.29l-1.41-1.41a1 1 0 111.41-1.42l1.42 1.42a1 1 0 01-.71 1.7zM4 13H2a1 1 0 110-2h2a1 1 0 110 2zm18 0h-2a1 1 0 110-2h2a1 1 0 110 2zM5.64 18.36a1 1 0 01-.71-1.71l1.42-1.41a1 1 0 111.41 1.41l-1.41 1.42a1 1 0 01-.71.29zM18.36 5.64a1 1 0 01-.7-1.71l1.41-1.41a1 1 0 111.41 1.41l-1.41 1.42a1 1 0 01-.71.29z"/></svg>
        latest
      </span>
      <time datetime="{{ $featured.Date.Format "2006-01-02T15:04:05Z07:00" }}">{{ $featured.Date.Format "Jan 2, 2006" }}</time>
      <span>{{ $words := countwords $featured.Content }}{{ if lt $words 200 }}1{{ else }}{{ math.Round (div (float $words) 200.0) }}{{ end }} min read</span>
      {{ with $featured.File }}{{ $audioFile := printf "audio/%s.mp3" (path.BaseName .Path) }}{{ if (fileExists (printf "static/%s" $audioFile)) }}
      <span aria-label="Audio available">
        <svg viewBox="0 0 24 24" width="12" height="12" fill="currentColor" aria-hidden="true"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55C7.79 13 6 14.79 6 17s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
      </span>
      {{ end }}{{ end }}
    </div>
    <h2 class="post-card__title"><a href="{{ $featured.Permalink }}">{{ $featured.Title }}</a></h2>
    {{ with $featured.Summary }}
    <p class="post-card__summary">{{ . | plainify | truncate 300 }}</p>
    {{ end }}
    {{ with $featured.Params.tags }}
    <div class="tag-list">
      {{ range . }}<a href="{{ "tags/" | absURL }}{{ . | urlize }}/" class="tag">{{ . }}</a>{{ end }}
    </div>
    {{ end }}
  </article>
  {{ partial "stats-widget.html" . }}
</div>

<!-- Previous Entries -->
{{ if gt (len $posts) 1 }}
<div class="container">
  <h2 class="section-header">Previous Entries</h2>
</div>

{{- $rest := after 1 $posts -}}
{{- $paginator := .Paginate $rest 9 -}}

<div class="grid-posts container">
  {{ range $paginator.Pages }}
  {{ partial "post-card.html" . }}
  {{ end }}
</div>

{{ partial "pagination.html" . }}
{{ end }}
{{ end }}

{{ end }}

{{ define "scripts" }}
<script defer src="{{ "js/status-cache.js" | relURL }}"></script>
<script defer src="{{ "js/hero-state.js" | relURL }}"></script>
<script defer src="{{ "js/status-widget.js" | relURL }}"></script>
<script defer src="{{ "js/live-dot.js" | relURL }}"></script>
<script defer src="{{ "js/footer-uptime.js" | relURL }}"></script>
<script defer src="{{ "js/mobile-nav.js" | relURL }}"></script>
{{ end }}
